---
- hosts: emmett
  roles:
    - role: lxc_guest
      vm_name: ca
    - role: ssh_server
      ansible_connection: lxc_ssh
      ansible_docker_extra_args: ca

- hosts: ca
  roles:
    - role: dns_record
    - role: reverse_proxy
    - role: nginx
      config_name: ca
      parent_role_path: static_website
  tasks:
    - name: create directories to serve
      file:
        path: "{{ server_path }}/{{ item }}"
        state: directory
        mode: 0755
        owner: www-data
        group: www-data
        recurse: yes
      with_items:
        - ca

- hosts: status
  roles:
    - role: icinga2-monitoring
